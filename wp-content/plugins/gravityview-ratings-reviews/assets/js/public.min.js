!function(a){"use strict";var b=a.extend({fieldClass:".comment-form-gv-review,.gv-star-rate-holder,.gv-vote-rating",respondId:"#respond",respondTempId:"#gv-ratings-reviews-temp-respond",commentParentId:"#comment_parent",commentId:"#comment",commentLabel:'label[for="comment"]:first',commentSubmit:'input[name="submit"]:first',replyTextId:"#reply-title",cancelId:"#cancel-comment-reply-link"},GV_RATINGS_REVIEWS);b.init=function(){b._holder=".gv-star-rate-holder, .gv-vote-rate-holder",b._star=".gv-star-rate",b._vote=".gv-vote-up, .gv-vote-down",b._input=".gv-star-rate-field",b._text=".gv-vote-rating-text",b._mutated=".gv-rate-mutated",b.$field=a(b._input),b.reply=a(".comment-reply-login, .comment-reply-link"),b.reply.removeAttr("onclick"),b.reply.on("click",b.moveForm),b.starHolder=a(b._holder),b.star=b.starHolder.find(b._star),b.star.on("click",b.starRateReview).on("mouseover",b.mouseOverStar).on("mouseout",b.mouseOutStar),0!==parseInt(b.$field.val(),10)&&b.star.eq(parseInt(b.$field.val(),10)-1).trigger("click"),b.voteHolder=a(".gv-vote-rate-holder"),b.vote=a("a.gv-vote-up, a.gv-vote-down",b.voteHolder),b.vote.on("click",b.voteRateReview),b.originalReplyText=b.getText(a(b.replyTextId)),b.originalCancelReplyText=b.getText(a(b.cancelId)),b.originalCommentLabelText=b.getText(a(b.commentLabel)),b.originalCommentSubmitText=a(b.commentSubmit).val()},b.moveForm=function(c){var d=a(c.target).parent().parent(),e=a(b.respondId),f=a(b.respondTempId),g=a(b.commentParentId),h=a(b.fieldClass);return f.length||(f=a("<div></div>"),f.attr("id",b.respondTempId.substr(1)),f.hide(),e.parent().append(f)),d.append(e),g.val(d.data("review_id")),h.hide(),b.replaceReplyText(b.comment_to_review_text,b.cancel_comment_to_review_text,b.comment_label_when_reply,b.comment_submit_when_reply),a(b.cancelId).show().on("click",b.cancelReply),a(b.commentId).focus(),!1},b.getText=function(b){return b=a(b),b.clone().children().remove().end().text()},b.replaceReplyText=function(c,d,e,f){var g=a(b.replyTextId),h=a(b.cancelId),i=a(b.commentLabel),j=a(b.commentSubmit);g.contents().each(function(){this.nodeType===this.TEXT_NODE&&(this.nodeValue=this.nodeValue.trim(),this.nodeValue.length&&(this.nodeValue=c))}),h.text(d),i.text(e),j.val(f)},b.cancelReply=function(c){var d=a(b.respondTempId),e=a(b.respondId),f=a(b.commentParentId),g=(a(b.replyTextId),a(c.target)),h=(a(b.commentLabel),a(b.commentSubmit),a(b.fieldClass));if(d.length&&e.length)return f.val(0),d.parent().append(e),d.remove(),b.replaceReplyText(b.originalReplyText,b.originalCancelReplyText,b.originalCommentLabelText,b.originalCommentSubmitText),g.hide(),g.off("click",b.cancelReply),h.show(),!1},b.mouseOverStar=function(c){var d=a(this),e=d.parents(b._holder),f=e.find(b._star),g=f.index(d);f.removeClass("gv-rate-mutated").each(function(b,c){var d=a(c);b>=g+1||d.addClass("gv-rate-mutated")})},b.mouseOutStar=function(c){var d=a(this),e=d.parents(b._holder),f=e.find(b._star);f.index(d);f.removeClass("gv-rate-mutated").filter('[data-selected="1"]').addClass("gv-rate-mutated")},b.starRateReview=function(c){var d=a(this),e=d.parents(b._holder),f=e.find(b._star),g=e.siblings(b._input),h=f.index(d);g.val(h+1),f.removeClass("gv-rate-mutated").attr("data-selected",0).each(function(b,c){var d=a(c);b>=h+1||d.addClass("gv-rate-mutated").attr("data-selected",1)})},b.voteRateReview=function(c){var d=a(this),e=d.parents(b._holder),f=e.find(b._vote),g=e.siblings(b._input),h=e.find(b._text),i=f.filter(b._mutated),j=d.is(i)?0:d.hasClass("gv-vote-up")?1:-1,k=0===j?b.vote_zero:1===j?b.vote_up:b.vote_down,l=0===j?b.vote_zero:_.template(b.vote_text_format)({number:j});return f.removeClass("gv-rate-mutated"),0!==j&&d.addClass("gv-rate-mutated"),h.text(k).attr("title",l),g.val(j),!1},a(b.init)}(jQuery,_);